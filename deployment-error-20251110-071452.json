{
  "Error": "EF Core migration failed with exit code 1",
  "StackTrace": "at Deploy-EFCoreMigrations, D:\\Repositories\\Hartonomous\\scripts\\deploy-database-unified.ps1: line 441\r\nat <ScriptBlock>, D:\\Repositories\\Hartonomous\\scripts\\deploy-database-unified.ps1: line 752\r\nat <ScriptBlock>, <No file>: line 1",
  "Log": [
    {
      "Message": "=== PHASE 0: Environment Initialization ===",
      "Level": "Info",
      "Timestamp": "2025-11-10 07:14:48"
    },
    {
      "Message": "Connected to SQL Server  ()",
      "Level": "Success",
      "Timestamp": "2025-11-10 07:14:48"
    },
    {
      "Message": "Edition: ",
      "Level": "Info",
      "Timestamp": "2025-11-10 07:14:48"
    },
    {
      "Message": "=== PHASE 1: Database Prerequisites ===",
      "Level": "Info",
      "Timestamp": "2025-11-10 07:14:48"
    },
    {
      "Message": "Database 'Hartonomous' already exists",
      "Level": "Info",
      "Timestamp": "2025-11-10 07:14:48"
    },
    {
      "Message": "All schemas created/verified",
      "Level": "Success",
      "Timestamp": "2025-11-10 07:14:48"
    },
    {
      "Message": "=== PHASE 2: EF Core Migrations ===",
      "Level": "Info",
      "Timestamp": "2025-11-10 07:14:48"
    },
    {
      "Message": "Using dotnet ef: Entity Framework Core .NET Command-line Tools 10.0.0-rc.2.25502.107",
      "Level": "Info",
      "Timestamp": "2025-11-10 07:14:48"
    },
    {
      "Message": "Applying EF Core migrations to database...",
      "Level": "Info",
      "Timestamp": "2025-11-10 07:14:48"
    },
    {
      "Message": "EF migration output: Using project 'D:\\Repositories\\Hartonomous\\src\\Hartonomous.Data\\Hartonomous.Data.csproj'. Using startup project 'D:\\Repositories\\Hartonomous\\src\\Hartonomous.Data\\Hartonomous.Data.csproj'. dotnet msbuild /getProperty:ProjectName /getProperty:AssemblyName /getProperty:DesignAssembly /getProperty:Language /getProperty:OutputPath /getProperty:PlatformTarget /getProperty:ProjectAssetsFile /getProperty:ProjectDir /getProperty:RootNamespace /getProperty:RuntimeFrameworkVersion /getProperty:TargetFileName /getProperty:TargetFrameworkMoniker /getProperty:Nullable /getProperty:TargetFramework /getProperty:TargetPlatformIdentifier /getProperty:Platform /t:ResolvePackageAssets /getItem:RuntimeCopyLocalItems D:\\Repositories\\Hartonomous\\src\\Hartonomous.Data\\Hartonomous.Data.csproj dotnet msbuild /getProperty:ProjectName /getProperty:AssemblyName /getProperty:DesignAssembly /getProperty:Language /getProperty:OutputPath /getProperty:PlatformTarget /getProperty:ProjectAssetsFile /getProperty:ProjectDir /getProperty:RootNamespace /getProperty:RuntimeFrameworkVersion /getProperty:TargetFileName /getProperty:TargetFrameworkMoniker /getProperty:Nullable /getProperty:TargetFramework /getProperty:TargetPlatformIdentifier /getProperty:Platform /t:ResolvePackageAssets /getItem:RuntimeCopyLocalItems D:\\Repositories\\Hartonomous\\src\\Hartonomous.Data\\Hartonomous.Data.csproj Build started... dotnet build D:\\Repositories\\Hartonomous\\src\\Hartonomous.Data\\Hartonomous.Data.csproj /verbosity:quiet /nologo /p:PublishAot=false  Build succeeded.     0 Warning(s)     0 Error(s)  Time Elapsed 00:00:01.10  Build succeeded. dotnet exec --depsfile D:\\Repositories\\Hartonomous\\src\\Hartonomous.Data\\bin\\Debug\\net10.0\\Hartonomous.Data.deps.json --additionalprobingpath C:\\Users\\ahart\\.nuget\\packages --runtimeconfig D:\\Repositories\\Hartonomous\\src\\Hartonomous.Data\\bin\\Debug\\net10.0\\Hartonomous.Data.runtimeconfig.json C:\\Users\\ahart\\.dotnet\\tools\\.store\\dotnet-ef\\10.0.0-rc.2.25502.107\\dotnet-ef\\10.0.0-rc.2.25502.107\\tools\\net10.0\\any\\tools\\net10.0\\any\\ef.dll database update --assembly D:\\Repositories\\Hartonomous\\src\\Hartonomous.Data\\bin\\Debug\\net10.0\\Hartonomous.Data.dll --project D:\\Repositories\\Hartonomous\\src\\Hartonomous.Data\\Hartonomous.Data.csproj --startup-assembly D:\\Repositories\\Hartonomous\\src\\Hartonomous.Data\\bin\\Debug\\net10.0\\Hartonomous.Data.dll --startup-project D:\\Repositories\\Hartonomous\\src\\Hartonomous.Data\\Hartonomous.Data.csproj --project-dir D:\\Repositories\\Hartonomous\\src\\Hartonomous.Data\\ --root-namespace Hartonomous.Data --language C# --framework net10.0 --design-assembly C:\\Users\\ahart\\.nuget\\packages\\microsoft.entityframeworkcore.design\\10.0.0-rc.2.25502.107\\lib\\net10.0\\Microsoft.EntityFrameworkCore.Design.dll --nullable --working-dir D:\\Repositories\\Hartonomous\\src\\Hartonomous.Data --verbose Using assembly 'Hartonomous.Data'. Using startup assembly 'Hartonomous.Data'. Using application base 'D:\\Repositories\\Hartonomous\\src\\Hartonomous.Data\\bin\\Debug\\net10.0'. Using working directory 'D:\\Repositories\\Hartonomous\\src\\Hartonomous.Data'. Using root namespace 'Hartonomous.Data'. Using project directory 'D:\\Repositories\\Hartonomous\\src\\Hartonomous.Data\\'. Remaining arguments: . Finding DbContext classes... Using environment 'Development'. Finding IDesignTimeDbContextFactory implementations... Found IDesignTimeDbContextFactory implementation 'HartonomousDbContextFactory'. Found DbContext 'HartonomousDbContext'. Finding DbContext classes in the project... Using DbContext factory 'HartonomousDbContextFactory'. Using context 'HartonomousDbContext'. Finding design-time services referenced by assembly 'Hartonomous.Data'... Finding design-time services referenced by assembly 'Hartonomous.Data'... Using design-time services from assembly 'Microsoft.EntityFrameworkCore.SqlServer.NetTopologySuite'. Finding design-time services for provider 'Microsoft.EntityFrameworkCore.SqlServer'... Using design-time services from provider 'Microsoft.EntityFrameworkCore.SqlServer'. Finding IDesignTimeServices implementations in assembly 'Hartonomous.Data'... No design-time services were found. Creating DbConnection. Created DbConnection. (11ms). Migrating using database 'Hartonomous' on server 'localhost'. Opening connection to database 'Hartonomous' on server 'localhost'. Opened connection to database 'Hartonomous' on server 'localhost'. Creating DbCommand for 'ExecuteNonQuery'. Created DbCommand for 'ExecuteNonQuery' (1ms). Initialized DbCommand for 'ExecuteNonQuery' (3ms). Executing DbCommand [Parameters=[], CommandType='Text', CommandTimeout='30'] SELECT 1 Executed DbCommand (8ms) [Parameters=[], CommandType='Text', CommandTimeout='30'] SELECT 1 Closing connection to database 'Hartonomous' on server 'localhost'. Closed connection to database 'Hartonomous' on server 'localhost' (1ms). Opening connection to database 'Hartonomous' on server 'localhost'. Opened connection to database 'Hartonomous' on server 'localhost'. Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long. Creating DbCommand for 'ExecuteScalar'. Created DbCommand for 'ExecuteScalar' (0ms). Initialized DbCommand for 'ExecuteScalar' (0ms). Executing DbCommand [Parameters=[], CommandType='Text', CommandTimeout='30'] DECLARE @result int; EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive'; SELECT @result Executed DbCommand (6ms) [Parameters=[], CommandType='Text', CommandTimeout='30'] DECLARE @result int; EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive'; SELECT @result Beginning transaction with isolation level 'Unspecified'. Began transaction with isolation level 'ReadCommitted'. Creating DbCommand for 'ExecuteNonQuery'. Created DbCommand for 'ExecuteNonQuery' (0ms). Initialized DbCommand for 'ExecuteNonQuery' (0ms). Executing DbCommand [Parameters=[], CommandType='Text', CommandTimeout='30'] IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL BEGIN     CREATE TABLE [__EFMigrationsHistory] (         [MigrationId] nvarchar(150) NOT NULL,         [ProductVersion] nvarchar(32) NOT NULL,         CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])     ); END; Executed DbCommand (1ms) [Parameters=[], CommandType='Text', CommandTimeout='30'] IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL BEGIN     CREATE TABLE [__EFMigrationsHistory] (         [MigrationId] nvarchar(150) NOT NULL,         [ProductVersion] nvarchar(32) NOT NULL,         CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])     ); END; Committing transaction. Committed transaction. Disposing transaction. Beginning transaction with isolation level 'Unspecified'. Began transaction with isolation level 'ReadCommitted'. Creating DbCommand for 'ExecuteNonQuery'. Created DbCommand for 'ExecuteNonQuery' (0ms). Initialized DbCommand for 'ExecuteNonQuery' (0ms). Executing DbCommand [Parameters=[], CommandType='Text', CommandTimeout='30'] SELECT 1 Executed DbCommand (0ms) [Parameters=[], CommandType='Text', CommandTimeout='30'] SELECT 1 Creating DbCommand for 'ExecuteScalar'. Created DbCommand for 'ExecuteScalar' (0ms). Initialized DbCommand for 'ExecuteScalar' (0ms). Executing DbCommand [Parameters=[], CommandType='Text', CommandTimeout='30'] SELECT OBJECT_ID(N'[__EFMigrationsHistory]'); Executed DbCommand (0ms) [Parameters=[], CommandType='Text', CommandTimeout='30'] SELECT OBJECT_ID(N'[__EFMigrationsHistory]'); Creating DbCommand for 'ExecuteReader'. Created DbCommand for 'ExecuteReader' (0ms). Initialized DbCommand for 'ExecuteReader' (0ms). Executing DbCommand [Parameters=[], CommandType='Text', CommandTimeout='30'] SELECT [MigrationId], [ProductVersion] FROM [__EFMigrationsHistory] ORDER BY [MigrationId]; Executed DbCommand (1ms) [Parameters=[], CommandType='Text', CommandTimeout='30'] SELECT [MigrationId], [ProductVersion] FROM [__EFMigrationsHistory] ORDER BY [MigrationId]; Closing data reader to 'Hartonomous' on server 'localhost'. A data reader for 'Hartonomous' on server 'localhost' is being disposed after spending 1ms reading results. Applying migration '20251110130647_SyncWithSqlSchema'. Creating DbCommand for 'ExecuteNonQuery'. Created DbCommand for 'ExecuteNonQuery' (0ms). Initialized DbCommand for 'ExecuteNonQuery' (0ms). Executing DbCommand [Parameters=[], CommandType='Text', CommandTimeout='30'] DROP INDEX [IX_TokenVocabulary_ModelId_TokenId] ON [TokenVocabulary]; Executed DbCommand (1ms) [Parameters=[], CommandType='Text', CommandTimeout='30'] DROP INDEX [IX_TokenVocabulary_ModelId_TokenId] ON [TokenVocabulary]; Creating DbCommand for 'ExecuteNonQuery'. Created DbCommand for 'ExecuteNonQuery' (0ms). Initialized DbCommand for 'ExecuteNonQuery' (0ms). Executing DbCommand [Parameters=[], CommandType='Text', CommandTimeout='30'] DECLARE @var nvarchar(max); SELECT @var = QUOTENAME([d].[name]) FROM [sys].[default_constraints] [d] INNER JOIN [sys].[columns] [c] ON [d].[parent_column_id] = [c].[column_id] AND [d].[parent_object_id] = [c].[object_id] WHERE ([d].[parent_object_id] = OBJECT_ID(N'[TokenVocabulary]') AND [c].[name] = N'TokenId1'); IF @var IS NOT NULL EXEC(N'ALTER TABLE [TokenVocabulary] DROP CONSTRAINT ' + @var + ';'); ALTER TABLE [TokenVocabulary] DROP COLUMN [TokenId1]; Failed executing DbCommand (15ms) [Parameters=[], CommandType='Text', CommandTimeout='30'] DECLARE @var nvarchar(max); SELECT @var = QUOTENAME([d].[name]) FROM [sys].[default_constraints] [d] INNER JOIN [sys].[columns] [c] ON [d].[parent_column_id] = [c].[column_id] AND [d].[parent_object_id] = [c].[object_id] WHERE ([d].[parent_object_id] = OBJECT_ID(N'[TokenVocabulary]') AND [c].[name] = N'TokenId1'); IF @var IS NOT NULL EXEC(N'ALTER TABLE [TokenVocabulary] DROP CONSTRAINT ' + @var + ';'); ALTER TABLE [TokenVocabulary] DROP COLUMN [TokenId1]; Disposing transaction. Creating DbCommand for 'ExecuteScalar'. Created DbCommand for 'ExecuteScalar' (0ms). Initialized DbCommand for 'ExecuteScalar' (0ms). Executing DbCommand [Parameters=[], CommandType='Text', CommandTimeout='30'] DECLARE @result int; EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session'; SELECT @result Executed DbCommand (0ms) [Parameters=[], CommandType='Text', CommandTimeout='30'] DECLARE @result int; EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session'; SELECT @result Closing connection to database 'Hartonomous' on server 'localhost'. Closed connection to database 'Hartonomous' on server 'localhost' (0ms). 'HartonomousDbContext' disposed. Disposing connection to database 'Hartonomous' on server 'localhost'. Disposed connection to database '' on server '' (0ms). Microsoft.Data.SqlClient.SqlException (0x80131904): ALTER TABLE DROP COLUMN failed because column 'TokenId1' does not exist in table 'TokenVocabulary'.    at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)    at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)    at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, SqlCommand command, Boolean callerHasConnectionLock, Boolean asyncClose)    at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)    at Microsoft.Data.SqlClient.SqlCommand.RunExecuteNonQueryTds(String methodName, Boolean isAsync, Int32 timeout, Boolean asyncWrite)    at Microsoft.Data.SqlClient.SqlCommand.InternalExecuteNonQuery(TaskCompletionSource`1 completion, Boolean sendToPipe, Int32 timeout, Boolean& usedCache, Boolean asyncWrite, Boolean inRetry, String methodName)    at Microsoft.Data.SqlClient.SqlCommand.ExecuteNonQuery()    at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQuery(RelationalCommandParameterObject parameterObject)    at Microsoft.EntityFrameworkCore.Migrations.MigrationCommand.ExecuteNonQuery(IRelationalConnection connection, IReadOnlyDictionary`2 parameterValues)    at Microsoft.EntityFrameworkCore.Migrations.Internal.MigrationCommandExecutor.Execute(IReadOnlyList`1 migrationCommands, IRelationalConnection connection, MigrationExecutionState executionState, Boolean beginTransaction, Boolean commitTransaction, Nullable`1 isolationLevel)    at Microsoft.EntityFrameworkCore.Migrations.Internal.MigrationCommandExecutor.<>c.<ExecuteNonQuery>b__3_1(DbContext _, ValueTuple`6 s)    at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.Execute[TState,TResult](TState state, Func`3 operation, Func`3 verifySucceeded)    at Microsoft.EntityFrameworkCore.Migrations.Internal.MigrationCommandExecutor.ExecuteNonQuery(IReadOnlyList`1 migrationCommands, IRelationalConnection connection, MigrationExecutionState executionState, Boolean commitTransaction, Nullable`1 isolationLevel)    at Microsoft.EntityFrameworkCore.Migrations.Internal.Migrator.MigrateImplementation(DbContext context, String targetMigration, MigrationExecutionState state, Boolean useTransaction)    at Microsoft.EntityFrameworkCore.Migrations.Internal.Migrator.<>c.<Migrate>b__20_1(DbContext c, ValueTuple`4 s)    at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass28_0`2.<Execute>b__0(DbContext context, TState innerState)    at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementation[TState,TResult](Func`3 operation, Func`3 verifySucceeded, TState state)    at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.Execute[TState,TResult](TState state, Func`3 operation, Func`3 verifySucceeded)    at Microsoft.EntityFrameworkCore.Migrations.Internal.Migrator.Migrate(String targetMigration)    at Microsoft.EntityFrameworkCore.Design.Internal.MigrationsOperations.UpdateDatabase(String targetMigration, String connectionString, String contextType)    at Microsoft.EntityFrameworkCore.Design.OperationExecutor.UpdateDatabaseImpl(String targetMigration, String connectionString, String contextType)    at Microsoft.EntityFrameworkCore.Design.OperationExecutor.UpdateDatabase.<>c__DisplayClass0_0.<.ctor>b__0()    at Microsoft.EntityFrameworkCore.Design.OperationExecutor.OperationBase.Execute(Action action) ClientConnectionId:4655651f-f6fb-425b-a32a-05ac4011b8a9 Error Number:4924,State:1,Class:16 ALTER TABLE DROP COLUMN failed because column 'TokenId1' does not exist in table 'TokenVocabulary'.",
      "Level": "Error",
      "Timestamp": "2025-11-10 07:14:52"
    },
    {
      "Message": "EF Core migration error: EF Core migration failed with exit code 1",
      "Level": "Error",
      "Timestamp": "2025-11-10 07:14:52"
    },
    {
      "Message": "ERROR: EF Core migration failed with exit code 1",
      "Level": "Error",
      "Timestamp": "2025-11-10 07:14:52"
    },
    {
      "Message": "Stack trace: at Deploy-EFCoreMigrations, D:\\Repositories\\Hartonomous\\scripts\\deploy-database-unified.ps1: line 441\r\nat <ScriptBlock>, D:\\Repositories\\Hartonomous\\scripts\\deploy-database-unified.ps1: line 752\r\nat <ScriptBlock>, <No file>: line 1",
      "Level": "Error",
      "Timestamp": "2025-11-10 07:14:52"
    }
  ]
}
